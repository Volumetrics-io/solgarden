<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Sol Garden â€” The mini roguelike for your desk</title>
    <script src="mrjs-build/mr.js"></script>
    <link rel="preload" href="/assets/fonts/JetBrainsMono-Medium.ttf" as="font" type="font/truetype" crossorigin />
    <style>
        @font-face {
            font-family: 'JetBrains';
            src: url('/assets/fonts/JetBrainsMono-Medium.ttf') format('truetype');
            font-weight: 400;
            font-style: normal;
        }

        html,
        body {
            background-color: #0a0a0a;
            font-family: 'JetBrains';
        }

        .end-turn {
            color: white;
            font-size: 200px;
            border-radius: 50px;
            padding: 150px;
        }

        .text-label {
            font-size: 10px;
        }

        .label-container {
            display: flex;
            flex-direction: row;
            gap: 20px;
        }
    </style>
</head>

<body>

    <mr-app orbital="true" stats="true">

        <mr-light color="#fff4b8" intensity="0.8" data-position="-0.25 1 -0.25"></mr-light>
        <mr-light color="#a4f1ff" intensity="0.5" data-position="0.5 0.1 0.5"></mr-light>

        <mr-entity data-comp-game="autoEndTurn: false; scale: 0.06; tableOffset: 0.02" data-comp-anchor="type: plane; label: table">

            <mr-ui id="interface"></mr-ui>
            <mr-entity id="chess-sound" data-comp-audio="src: ./assets/audio/chess.mp3; loop: false; state: stop;"></mr-entity>
            <!-- <mr-entity id="door-sound" data-comp-audio="src: ./assets/audio/door-hinge.mp3; loop: false; state: stop;"></mr-entity> -->
            <mr-entity id="analog-sound" data-comp-audio="src: ./assets/audio/analog.mp3; loop: false; state: stop;"></mr-entity>
            <mr-entity id="clash-sound" data-comp-audio="src: ./assets/audio/clash.mp3; loop: false; state: stop;"></mr-entity>
            <mr-entity id="nope-sound" data-comp-audio="src: ./assets/audio/nope.mp3; loop: false; state: stop;"></mr-entity>
            <mr-entity id="swoosh-sound" data-comp-audio="src: ./assets/audio/swoosh.mp3; loop: false; state: stop;"></mr-entity>
            <mr-entity id="latch-sound" data-comp-audio="src: ./assets/audio/latch.mp3; loop: false; state: stop;"></mr-entity>
            <!-- <mr-entity id="bg-music" data-comp-audio="src: ./assets/audio/immersion-cut.mp3; loop: true; state: stop;"></mr-entity> -->
            <mr-entity id="fridge-sound" data-comp-audio="src: ./assets/audio/fridge.mp3; loop: true; state: stop;"></mr-entity>
            <mr-entity id="farm-sound" data-comp-audio="src: ./assets/audio/farm.mp3; loop: true; state: stop;"></mr-entity>
            <mr-entity id="badlands-sound" data-comp-audio="src: ./assets/audio/badlands.mp3; loop: true; state: stop;"></mr-entity>
        </mr-entity>
    </mr-app>

    <script>
        const DefaultState = {
            isDebug: false,
            isInteractive: true,
            staticUntil: 0,
            level: 0,
            health: 10,
            range: 15,
            action: 4,
            projectedCost: 0,
            hasKey: false,
            meleeName: '',
            meleeAttack: 0,
            meleeRange: 1,
            rangeName: '',
            rangeAttack: 0,
            rangeRange: 0,
            selectedWeapon: "melee",
            isPlayerTurn: true,
        }

        const State = structuredClone(DefaultState);

        const Colors = {
            movement: "#00ffff",
            objects: "#ff7a00",
            neutral: "#888",
            hover: "#875dff",
            health: "#e72d75",
            range: "#00e82c",
            enemies: "#ff0000",
            debug: '#00ff00',
            white: '#ffffff'
        }

        const EnemySubtypes = [
            'static',
            'homing',
            'aimless',
        ];

        const EnemyModels = {
            static: "assets/models/enemy-static1.glb",
            homing: "assets/models/enemy-floater1.glb",
            aimless: "assets/models/enemy-horse1.glb",
        }

        const WeaponModels = {
            twig: "assets/models/weapon-stick1-pickup.glb",
            shortsword: "assets/models/weapon-shortSword1-pickup.glb",
            slingshot: "assets/models/weapon-slingshot1-pickup.glb",
            bow: "assets/models/weapon-bow1-pickup.glb",
        }

        const SpawnRoomParams = () => {
            return {
                floorCount: 1,
                rowCount: 6,
                colCount: 4,
                enemyCount: 0,
                propCount: 0,
                blockCount: 0,
                isChest: false,
                biome: {
                    name: 'spawn',
                    path: "assets/biomes/purple/",
                    audio: "",
                    tiles: ["tilegrasspurple001.glb"],
                    props: [],
                    block: [],
                }
            }
        }

        const BatteryRoomParams = () => {
            return {
                floorCount: 1,
                rowCount: 8,
                colCount: 4,
                enemyCount: 0,
                propCount: 12,
                blockCount: 0,
                isChest: false,
                isLore: false,
                biome: {
                    name: 'battery',
                    path: "assets/biomes/battery-room/",
                    audio: "/assets/audio/fridge.mp3",
                    tiles: ["tilegrass001.glb"],
                    props: ["plant_01.glb",
                        "plant_02.glb",
                        "plant_03.glb",
                        "plant_04.glb",
                        "plant_05.glb"
                    ],
                    block: []
                },
                entityMap: [
                    [0, 0, 0, 0],
                    [0, 0, 0, 0],
                    [0, 0, 0, 0],
                    [0, {
                        el: document.createElement("mr-battery-ii"),
                        type: 'prop'
                    }, {
                        el: document.createElement("mr-battery-i"),
                        type: 'prop'
                    }, 0],
                    [0, 0, {
                        el: document.createElement("mr-battery-iv"),
                        type: 'prop'
                    }, 0],
                    [0, 0, 0, 0],
                    [0, 0, 0, 0],
                    [0, 0, 0, 0],
                ],
                propMap: [
                    [0, 0, 0, 0],
                    [0, 0, 0, 0],
                    [0, 0, 0, 0],
                    [0, 0, 0, 0],
                    [0, {
                        el: document.createElement("mr-battery-iii"),
                        type: 'battery'
                    }, 0, 0],
                    [0, 0, 0, 0],
                    [0, 0, 0, 0],
                    [0, 0, 0, 0],
                ]
            }
        }

        const SoundController = {
            sounds: {
                chessSound: document.querySelector('#chess-sound'),
                // doorHinge: document.querySelector('#door-sound'),
                analogSound: document.querySelector('#analog-sound'),
                clashSound: document.querySelector('#clash-sound'),
                nopeSound: document.querySelector('#nope-sound'),
                swooshSound: document.querySelector('#swoosh-sound'),
                latchSound: document.querySelector('#latch-sound'),
                spawn: document.querySelector('#farm-sound'),
                battery: document.querySelector('#fridge-sound'),
                plains: document.querySelector('#farm-sound'),
                desert: document.querySelector('#badlands-sound'),
            },
            initialize: function() {
                this.sounds["spawn"].components.set('audio', {
                    action: 'pause'
                });
                this.sounds["battery"].components.set('audio', {
                    action: 'pause'
                });
                this.sounds["plains"].components.set('audio', {
                    action: 'pause'
                });
                this.sounds["desert"].components.set('audio', {
                    action: 'pause'
                });
            },
            play: function(sound) {
                this.sounds[sound].components.set('audio', {
                    action: 'play'
                });
            },
            background(sound) {
                this.sounds['spawn'].components.set('audio', {
                    action: 'pause'
                });
                this.sounds['battery'].components.set('audio', {
                    action: 'pause'
                });
                this.sounds['plains'].components.set('audio', {
                    action: 'pause'
                });
                this.sounds['desert'].components.set('audio', {
                    action: 'pause'
                });
                this.play(sound);
            }
        }

        // Various animation curves / timing functions
        // Not all of them are used in this project
        const Animator = {
            easeInOut: time => {
                return time < 0.5 ? 4 * time * time * time : (time - 1) * (2 * time - 2) * (2 * time - 2) + 1;
            },
            easeOutBack: time => {
                return Math.pow(time - 1, 2) * ((1.70158 + 1) * (time - 1) + 1.70158) + 1;
            },
            elastic: time => {
                return Math.pow(2, -5 * time) * Math.sin(((time - 0.3 / 4) * (Math.PI * 2)) / 0.3) + 1;
            },
            fanOut: time => {
                return 2 / (1 + Math.pow(1000, -time)) - 1;
            },
            rollercoaster: time => {
                return (-1.15 * Math.sin(time * 7.7)) / (time * 7.7) + 1.15;
            },
            linear: time => {
                return time;
            },
            jump: time => {
                return -((2 * time - 1) * (2 * time - 1)) + 1;
            },
            softJump: time => {
                return 1 - (Math.cos(time * 2 * Math.PI) / 2 + 0.5);
            }
        };
    </script>

    <!-- Utils -->
    <!--
        Note: We place this first so that other scripts can share the
        functions it contains since JavaScript executes sequentially.
    -->
    <script src="/js/utils.js"></script>

    <!-- Classes -->
    <script src="/js/pathfinder.js"></script>
    <script src="/js/board.js"></script>

    <!-- MRjs Systems -->
    <script src="/js/systems/mr-game.js"></script>

    <!-- Mrjs Entities -->
    <script src="/js/entities/mr-ui.js"></script>
    <script src="/js/entities/mr-battery.js"></script>
    <script src="/js/entities/mr-chest.js"></script>
    <script src="/js/entities/mr-door.js"></script>
    <script src="/js/entities/mr-enemy.js"></script>
    <script src="/js/entities/mr-goal.js"></script>
    <script src="/js/entities/mr-key.js"></script>
    <script src="/js/entities/mr-loot.js"></script>
    <script src="/js/entities/mr-lore.js"></script>
    <script src="/js/entities/mr-player.js"></script>
    <script src="/js/entities/mr-projectile.js"></script>
    <script src="/js/entities/mr-prop.js"></script>
    <script src="/js/entities/mr-tile.js"></script>
    <script src="/js/entities/mr-weapon.js"></script>

</body>

</html>
