<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Sol Garden â€” The mini roguelike for your desk</title>
    <script src="mrjs-build/mr.js"></script>
    <link rel="preload" href="/assets/fonts/JetBrainsMono-Medium.ttf" as="font" type="font/truetype" crossorigin />
    <style>
        @font-face {
            font-family: 'JetBrains';
            src: url('/assets/fonts/JetBrainsMono-Medium.ttf') format('truetype');
            font-weight: 400;
            font-style: normal;
        }

        :root {
            --scale: 0.06;
        }

        html,
        body {
            background-color: #0a0a0a;
            font-family: 'JetBrains';
        }

        .end-turn {
            color: white;
            font-size: 200px;
            border-radius: 50px;
            padding: 150px;
        }

        .text-label {
            font-size: 10px;
        }

        .label-container {
            display: flex;
            flex-direction: row;
            gap: 20px;
        }

        #start-wall {
            pointer-events: none;
            scale: var(--scale);
        }

        #ui {
            scale: var(--scale);
        }

        /* mr-text {
            min-width: 100vw;
        } */

        .hud-text {
            color: #ffffff;
            font-size: calc(10px / var(--scale));
            /* width: calc(2000px / var(--scale)); */
        }

        #hp-label, #range-label {
            width: calc(400px / var(--scale));
            height: calc(200px / var(--scale));
        }

        .wall-text {
            color: #333;
            font-size: calc(10px / var(--scale));
            width: calc(2000px / var(--scale));
        }

        .progress-bar {
            scale: 0.75;
        }

        #end-turn-button {
            font-size: calc(13px / var(--scale));
            width: calc(800px / var(--scale));
            height: calc(800px / var(--scale));
            border-radius: calc(3px / var(--scale));
        }
    </style>
</head>

<body>


    <!-- <mr-app orbital="true" stats="true" debug='true'> -->
        <mr-app orbital="true" stats="true">

        <mr-light color="#fff4b8" intensity="0.8" data-position="-0.25 1 -0.25"></mr-light>
        <mr-light color="#a4f1ff" intensity="0.5" data-position="0.5 0.1 0.5"></mr-light>

        <mr-entity class='game' data-comp-game="autoEndTurn: false; tableOffset: 0.02" data-comp-anchor="type: plane; label: table">

            <mr-ui id="interface"></mr-ui>
            <mr-damage-tile id="damage-tile"></mr-damage-tile>

            <!-- The wall behind the first room -->
            <mr-div id='start-wall' data-rotation='0 270 0'>
                <mr-model class="solgarden" src='./assets/ui-models/wall.glb'></mr-model>
                <mr-div data-position='0 2 0.55'>
                    <mr-text id='disposed-robots' class='wall-text' data-position='-1.5 -0.4 0'>loading</mr-text>
                    <mr-text id='farthest-room' class='wall-text' data-position='-1.5 -0.6 0'>loading</mr-text>
                </mr-div>
            </mr-div>

            <!-- The floating UI in front of the board -->
            <mr-div id='ui' data-rotation='270 -30 270'>

                <!-- The HP bar and label -->
                <mr-div data-position='0 0.3 0'>
                    <mr-text id='hp-label' class='hud-text' data-position='-0.25 0 0'>99</mr-text>
                    <mr-model id="hp-progress" class="progress-bar"
                            src='./assets/ui-models/UI_bar1-red.glb'
                            data-rotation='90 0 0'></mr-model>
                </mr-div>

                <!-- The range bar and label -->
                <mr-div data-position='0 0 0'>
                    <mr-text id='range-label' class='hud-text' data-position='-0.25 0 0'>99</mr-text>
                    <mr-model id="range-progress" class="progress-bar"
                            src='./assets/ui-models/UI_bar1-green.glb'
                            data-rotation='90 0 0'></mr-model>
                </mr-div>


                <!-- <mr-text id='range-label' class='hud-text' data-position='-0.05 0.1 0'>99</mr-text>
                <mr-model id="range-progress" class="progress-bar"
                        src='./assets/ui-models/UI_bar1-green.glb'
                        data-position='-0.75 0 0'
                        data-rotation='90 0 0'></mr-model> -->

                <!-- <mr-model class="ui-countertop" src='./assets/ui-models/ui-plane.glb'></mr-model> -->
                <mr-button id='end-turn-button' data-position='2.6 0 0'>End</mr-button>

                <mr-ui-melee id='ui-melee' data-rotation='270 180 180' data-position='-2.5 0 0'></mr-ui-melee>
                <mr-ui-range id='ui-range' data-rotation='270 180 180' data-position='-1.5 0 0'></mr-ui-melee>
            </mr-div>

            <mr-entity id="chess-sound" data-comp-audio="src: ./assets/audio/chess.mp3; loop: false; state: stop;"></mr-entity>
            <!-- <mr-entity id="door-sound" data-comp-audio="src: ./assets/audio/door-hinge.mp3; loop: false; state: stop;"></mr-entity> -->
            <mr-entity id="analog-sound" data-comp-audio="src: ./assets/audio/analog.mp3; loop: false; state: stop;"></mr-entity>
            <mr-entity id="clash-sound" data-comp-audio="src: ./assets/audio/clash.mp3; loop: false; state: stop;"></mr-entity>
            <mr-entity id="nope-sound" data-comp-audio="src: ./assets/audio/nope.mp3; loop: false; state: stop;"></mr-entity>
            <mr-entity id="swoosh-sound" data-comp-audio="src: ./assets/audio/swoosh.mp3; loop: false; state: stop;"></mr-entity>
            <mr-entity id="latch-sound" data-comp-audio="src: ./assets/audio/latch.mp3; loop: false; state: stop;"></mr-entity>
            <!-- <mr-entity id="bg-music" data-comp-audio="src: ./assets/audio/immersion-cut.mp3; loop: true; state: stop;"></mr-entity> -->
            <mr-entity id="fridge-sound" data-comp-audio="src: ./assets/audio/fridge.mp3; loop: true; state: stop;"></mr-entity>
            <mr-entity id="plains-sound" data-comp-audio="src: ./assets/audio/farm.mp3; loop: true; state: stop;"></mr-entity>
            <mr-entity id="desert-sound" data-comp-audio="src: ./assets/audio/badlands.mp3; loop: true; state: stop;"></mr-entity>
            <mr-entity id="night-forest" data-comp-audio="src: ./assets/audio/night-forest.mp3; loop: true; state: stop;"></mr-entity>

        </mr-entity>
    </mr-app>

    <script>

        const DEFAULT_STATE = {
            isDebug: false,
            isInteractive: true,
            staticUntil: 0,
            level: 0,
            health: 10,
            range: 15,
            action: 4,
            projectedCost: 0,
            hasKey: false,

            // TODO: Proposal for today
            weapons: [
                {
                    type: 'melee',
                    subtype: 'twig',
                    range: 1,
                    crits: 0.1
                },
                {
                    type: 'range',
                    subtype: 'bow',
                    range: 3,
                    crits: 0.05
                }
            ],
            selectedWeapon: 0,


            meleeName: '',
            meleeAttack: 0,
            meleeRange: 1,
            rangeName: '',
            rangeAttack: 0,
            rangeRange: 0,
            selectedWeapon: "melee",
            isPlayerTurn: true,
        }

        const State = structuredClone(DEFAULT_STATE);

        const COLORS = {
            movement: "#00ffff",
            objects: "#ff7a00",
            neutral: "#888",
            hover: "#875dff",
            health: "#e72d75",
            range: "#00e82c",
            enemies: "#ff0000",
            debug: '#00ff00',
            white: '#ffffff'
        }


        const ENEMY_SUBTYPES = [
            'static',
            'homing',
            'aimless',
        ];

        const ENEMY_MODELS = {
            static: "assets/models/enemy-static1.glb",
            homing: "assets/models/enemy-floater1.glb",
            aimless: "assets/models/enemy-horse1.glb",
        }


        const WEAPON_MODELS = {
            twig: "assets/models/weapon-stick1-pickup.glb",
            shortsword: "assets/models/weapon-shortSword1-pickup.glb",
            slingshot: "assets/models/weapon-slingshot1-pickup.glb",
            bow: "assets/models/weapon-bow1-pickup.glb",
        }

        const generateSpawnRoomParams = () => {
            return {
                floorCount: 1,
                rowCount: 6,
                colCount: 4,
                enemyCount: 0,
                propCount: 0,
                blockCount: 0,
                isChest: false,
                biome: {
                    name: 'spawn',
                    path: "assets/biomes/purple/",
                    audio: "",
                    tiles: ["tilegrasspurple001.glb"],
                    props: [],
                    block: [],
                }
            }
        }


        const generateBatteryRoomParams = () => {
            return {
                floorCount: 1,
                rowCount: 8,
                colCount: 4,
                enemyCount: 0,
                propCount: 12,
                blockCount: 0,
                isChest: false,
                isLore: false,
                biome: {
                    name: 'battery',
                    path: "assets/biomes/battery-room/",
                    audio: "/assets/audio/fridge.mp3",
                    tiles: ["tilegrass001.glb"],
                    props: ["plant_01.glb",
                        "plant_02.glb",
                        "plant_03.glb",
                        "plant_04.glb",
                        "plant_05.glb"
                    ],
                    block: []
                },
                entityMap: [
                    [0, 0, 0, 0],
                    [0, 0, 0, 0],
                    [0, 0, 0, 0],
                    [0, {
                        el: document.createElement("mr-battery-ii"),
                        type: 'prop'
                    }, {
                        el: document.createElement("mr-battery-i"),
                        type: 'prop'
                    }, 0],
                    [0, 0, {
                        el: document.createElement("mr-battery-iv"),
                        type: 'prop'
                    }, 0],
                    [0, 0, 0, 0],
                    [0, 0, 0, 0],
                    [0, 0, 0, 0],
                ],
                propMap: [
                    [0, 0, 0, 0],
                    [0, 0, 0, 0],
                    [0, 0, 0, 0],
                    [0, 0, 0, 0],
                    [0, {
                        el: document.createElement("mr-battery-iii"),
                        type: 'battery'
                    }, 0, 0],
                    [0, 0, 0, 0],
                    [0, 0, 0, 0],
                    [0, 0, 0, 0],
                ]
            }
        }


        const Biomes = [{
                // plains
                name: "plains",
                path: "assets/biomes/plains/",
                // audio: "/assets/audio/farm.mp3",
                tiles: ["tilegrass001.glb", "tilegrass002.glb", "tilegrass003.glb"],
                props: ["plant_01.glb", "plant_02.glb", "plant_03.glb", "plant_04.glb", "plant_05.glb"],
                block: ["rock001.glb"]
            },
            {
                // desert
                name: "desert",
                path: "assets/biomes/deserts/",
                // audio: "/assets/audio/badlands.mp3",
                tiles: ["tiledesert001.glb", "tiledesert002.glb", "tiledesert003.glb"],
                props: ["plant_05_to_test.glb"],
                block: ["rockdesert001.glb", "rockdesert002.glb"]
            },
            {
                // forest
                name: "forest",
                path: "assets/biomes/forest/",
                // audio: "/assets/audio/badlands.mp3",
                tiles: ["tileforest001.glb"],
                props: ["plant_06-fern1.glb", "plant_07-mushrooms1.glb"],
                block: ["pine1.glb", "rockforest001.glb", "stump1.glb"]
            }
        ]

        // Various animation curves / timing functions
        // Not all of them are used in this project
        const Animator = {
            easeInOut: time => {
                return time < 0.5 ? 4 * time * time * time : (time - 1) * (2 * time - 2) * (2 * time - 2) + 1;
            },
            easeOutBack: time => {
                return Math.pow(time - 1, 2) * ((1.70158 + 1) * (time - 1) + 1.70158) + 1;
            },
            elastic: time => {
                return Math.pow(2, -5 * time) * Math.sin(((time - 0.3 / 4) * (Math.PI * 2)) / 0.3) + 1;
            },
            fanOut: time => {
                return 2 / (1 + Math.pow(1000, -time)) - 1;
            },
            rollercoaster: time => {
                return (-1.15 * Math.sin(time * 7.7)) / (time * 7.7) + 1.15;
            },
            linear: time => {
                return time;
            },
            jump: time => {
                return -((2 * time - 1) * (2 * time - 1)) + 1;
            },
            softJump: time => {
                return 1 - (Math.cos(time * 2 * Math.PI) / 2 + 0.5);
            }
        };
    </script>

    <!-- Utils -->
    <!--
        Note: We place this first so that other scripts can share the
        functions it contains since JavaScript executes sequentially.
    -->
    <script src="/js/utils.js"></script>

    <!-- Classes -->
    <script src="/js/sound-controller.js"></script>

    <script src="/js/pathfinder.js"></script>
    <script src="/js/board.js"></script>

    <!-- MRjs Systems -->
    <script src="/js/systems/mr-game.js"></script>

    <!-- Mrjs Entities -->
    <script src="/js/entities/mr-ui.js"></script>
    <script src="/js/entities/mr-battery.js"></script>
    <script src="/js/entities/mr-chest.js"></script>
    <script src="/js/entities/mr-door.js"></script>
    <script src="/js/entities/mr-enemy.js"></script>
    <script src="/js/entities/mr-goal.js"></script>
    <script src="/js/entities/mr-key.js"></script>
    <script src="/js/entities/mr-loot.js"></script>
    <script src="/js/entities/mr-lore.js"></script>
    <script src="/js/entities/mr-player.js"></script>
    <script src="/js/entities/mr-projectile.js"></script>
    <script src="/js/entities/mr-prop.js"></script>
    <script src="/js/entities/mr-tile.js"></script>
    <script src="/js/entities/mr-weapon.js"></script>
    <script src="/js/entities/mr-damage-tile.js"></script>

    <script src="/js/entities/mr-ui-melee.js"></script>
    <script src="/js/entities/mr-ui-range.js"></script>
    <!-- <script src="/js/entities/mr-start-wall.js"></script> -->


</body>

</html>
