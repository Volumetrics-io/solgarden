<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Sol Garden</title>
    <style>
        * {
            border: none;
            padding: 0;
            margin: 0;
            box-sizing: border-box;
        }

        #root {
            position: relative;
            border: 1px solid red;
            width: 800px;
            height: 800px;
        }

        .tile {
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>

<body>
    <main id="root"></main>

    <script src="heightmap.js"></script>
    <script>

        window.onload = () => {

            const scale = 120;



            const comp = {
                rows: 5,
                cols: 5,
                floors: 5
            }

            // player
            window.goal = window.player = {
                x: Math.floor(Math.random() * comp.rows),
                y: Math.floor(Math.random() * comp.cols)
            }

            // goal
            while (window.goal == window.player) {
                window.goal = {
                    x: Math.floor(Math.random() * comp.rows),
                    y: Math.floor(Math.random() * comp.cols)
                }
            }

            const heightMap = Array.from({ length: comp.rows }, (_, x) =>
                Array.from({ length: comp.cols }, (_, y) => Math.floor(smoothNoise(x * 0.5, y * 0.5) * comp.floors))
            );

            const root = document.querySelector('#root');

            // tiles
            const tilemap = [];
            for (let f = 0; f < comp.floors; f++) {
                const floor = [];

                for (let r = 0; r < comp.rows; r++) {
                    const row = [];

                    for (let c = 0; c < comp.cols; c++) {

                        let isTop = (f === heightMap[r][c]);
                        if (f <= heightMap[r][c]) {

                            let tile = document.createElement("div");
                            tile.className = 'tile';
                            let bgColor = (f / comp.floors) * 0.8 + 0.2;
                            Object.assign(tile.style, {
                                position: 'absolute',
                                top: (r * scale + f * 10) + "px",
                                left: (c * scale + f * 10) + "px",
                                height: scale + "px",
                                width: scale + "px",
                                border: `1px solid rgba(255, 255, 255, ${f / comp.floors})`,
                                backgroundColor: `rgba(0, 0, 0, ${bgColor})`,
                                color: `hsl(0, 100%, 100%)`,
                            });
                            tile.dataset.floor = f;
                            tile.innerHTML = f;

                            tile.addEventListener('mouseover', () => {
                                // addMove(x + 1, y + 2, level);
                                // addMove(x + 2, y + 1, level);
                                // addMove(x + 2, y - 1, level);
                                // addMove(x + 1, y - 2, level);
                                // addMove(x - 1, y - 2, level);
                                // addMove(x - 2, y - 1, level);
                                // addMove(x - 2, y + 1, level);
                                // addMove(x - 1, y + 2, level);
                                console.log(r, c);
                            })

                            tile.addEventListener('click', () => {
                                console.log(r, c);
                            })

                            root.append(tile);

                            row.push(tile);
                        }

                    }

                    floor.push(row);
                }

                tilemap.push(floor);

            }

            let playerTile = document.createElement("div");
            playerTile.className = 'tile';
            Object.assign(playerTile.style, {
                position: 'absolute',
                top: (window.player.x * scale + heightMap[window.player.x][window.player.y] * 10 + 10) + "px",
                left: (window.player.y * scale + heightMap[window.player.x][window.player.y] * 10 + 10) + "px",
                height: scale + "px",
                width: scale + "px",
                border: `1px solid red`,
                backgroundColor: `yellow`,
                borderRadius: '20px',
                color: `black`
            });
            playerTile.innerHTML = "Player";
            root.append(playerTile);

            let goalTile = document.createElement("div");
            goalTile.className = 'tile';
            Object.assign(goalTile.style, {
                position: 'absolute',
                top: (window.goal.x * scale + heightMap[window.goal.x][window.goal.y] * 10 + 10) + "px",
                left: (window.goal.y * scale + heightMap[window.goal.x][window.goal.y] * 10 + 10) + "px",
                height: scale + "px",
                width: scale + "px",
                border: `1px solid red`,
                backgroundColor: `green`,
                borderRadius: '20px',
                color: `black`
            });
            goalTile.innerHTML = "Goal";
            root.append(goalTile);
        }

    </script>
</body>

</html>